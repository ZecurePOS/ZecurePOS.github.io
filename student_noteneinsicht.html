<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <link rel=stylesheet type=text/css href="static/style.css" />
    <title>Student - Home</title>

</head>

<body>
    <h1 class="header">Willkommen, <span id="username"></span></h1>
    <hr><br>
    <h2>Ihre Noten</h2>
    <table id="noten">
        <tr>
            <th>Fach</th>
            <th>Note</th>
            <th>Datum</th>
        </tr>
    </table>
    <br><br><br>
    <input id="dlbutton" name="download" value="Download Noten PDF" type="button" />
    <div class="logout">
        <form action="/logout" method="DELETE">
            <input type="submit" value="logout">
        </form>
    </div>
</body>

<script type="text/javascript">
    function htmlToCSV(html, filename) {
        var data = [];
        var rows = document.querySelectorAll("table tr");
        for (var i = 0; i < rows.length; i++) {
            var row = [],
                cols = rows[i].querySelectorAll("td, th");
            for (var j = 0; j < cols.length; j++) {
                row.push(cols[j].innerText);
            }
            data.push(row.join(","));
        }
        downloadCSVFile(data.join("\n"), filename);
    }

    function downloadCSVFile(csv, filename) {
        var csv_file, download_link;
        csv_file = new Blob([csv], {
            type: "text/csv"
        });
        download_link = document.createElement("a");
        download_link.download = filename;
        download_link.href = window.URL.createObjectURL(csv_file);
        download_link.style.display = "none";
        document.body.appendChild(download_link);
        download_link.click();
    }

    document.getElementById("dlbutton").addEventListener("click", function() {
        var html = document.querySelector("table").outerHTML;
        var username = document.getElementById('username').innerText;
        htmlToCSV(html, username + "_noten.csv");
    });
</script>

</html>
